<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/public/css/bootstrap.min.css">
    <script defer src="/public/fontawesome/js/brands.js"></script>
    <script defer src="/public/fontawesome/js/solid.js"></script>
    <script defer src="/public/fontawesome/js/fontawesome.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css">
</head>
<body>
    <div class="container pt-5">
        <div id="wrapper"></div>
    </div>
    <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const grid = new gridjs.Grid({
            columns: [
                {name: 'id', visible: true},
                {name: 'Nombre'},
                {name: 'Fecha de nacimiento'},
                {name: 'Edad'},
                {name: 'Genero'},
                {name: 'Correo'},
                {
                    name: 'Options', attributes: (_, row) => {
                        console.log(row);
                        return {
                            onClick: async (e) => {
                                e.preventDefault();
                                if (e.target.dataset.action === 'borrar') {
                                    const result = await Swal.fire({
                                        title: "¿Está seguro de borrar este cliente?",
                                        icon: "warning",
                                        showCancelButton: true,
                                        confirmButtonColor: "#3085d6",
                                        cancelButtonColor: "#d33",
                                        confirmButtonText: "Si"
                                    });
                                    if (result.isConfirmed) {
                                        await fetch(`/clients/${row.cells[0].data}`, {method: 'DELETE'});
                                        const Toast = Swal.mixin({
                                            toast: true,
                                            position: "top-end",
                                            showConfirmButton: false,
                                        });
                                        Toast.fire({
                                            icon: "success",
                                            title: "Borrado!"
                                        });
                                        grid.forceRender();
                                    }
                                } else {

                                }
                            }
                        };
                    }, formatter: (_, row) => {

                        return gridjs.html(`<div class="dropdown">
  <div data-bs-toggle="dropdown"><i class="fa-solid fa-ellipsis-v" ></i></div>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/client?id=${row.cells[0].data}" target="_blank">Ver</a></li>
    <li><a class="dropdown-item" href="/clients/${row.cells[0].data}/pdf" data-action="borrar">Borrar</a></li>
    <li><a class="dropdown-item" href="/clients/${row.cells[0].data}/pdf">Imprimir en PDF</a></li>
  </ul>
</div>`);
                    }
                },
            ],
            server: {
                url: 'http://127.0.0.1:3000/getClients',
                then: data => data.map(x => [x.clave, x.nombre, x.fechanac, x.edad, x.genero, x.email]
                )
            },
            height: '80vh',
            pagination: {
                // limit: 2,
                summary: false
            }
        }).render(document.getElementById('wrapper'));

    </script>
</body>
</html>
